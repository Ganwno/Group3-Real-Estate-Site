<%
#   Created: Daniel Swain
#   Date: 27/04/2016
#
#   Partial to display the user settings
%>

<% # The page header %>
<h1 class="ui center aligned">Settings</h1>

<% # If the user has just signed up they will be redirected here and will see the following message. This message will only show the first time after sign-up %>
<% if flash[:just_signed_up] %>
	<% # A positive message block that is dismissable %>
	<div class="ui positive message">
		<% # The close icon %>
		<i class="close icon"></i>
		<% # The header text is set in the registrations_controller.rb (see the flash[:just_signed_up] declaration) %>
		<div class="header">
			<%= flash[:just_signed_up] %>
		</div>
		<% # The message content (in this case, instructions to the user about what they should do next) %>
		<p>Thanks for signing up! This page is where you can set your username and other personal details.</p>
		<p>You can also upload a profile picture and set your notification preferences.</p>
	</div>
<% end %>

<% # The user has successfully updated %>
<% if flash[:updated] %>
	<div class="ui positive message">
		<i class="close icon"></i>
		<div class="header">
			Success!
		</div>
		<p><%= flash[:updated] %></p>
	</div>
<% end %>

<% # if there are errors display them here %>
<% if flash[:errors] %>
	<% # A negative message block that is dismissably %>
	<div class="ui negative message">
		<% # The close icon %>
		<i class="close icon"></i>
		<div class="header">Please fix the following errors and try again.</div>
		<% # Display the error list %>
		<% flash.each do |name, msg| %>
			<% if msg.class == Array %>
				<div class="ui bulleted list">
					<% msg.each do |message| %>
						<%= content_tag :div, message, :id => "flash_#{name}", class: "item" %>
					<% end %>
				</div>
			<% end %>
		<% end %>
	</div>
<% end %>

<% # The remaining settings actions to go here %>
<%= form_for(current_user, as: resource_name, url: registration_path(resource_name), html: { method: :put, class: "ui form error" }) do |f| %>
	<% # Avatar upload field %>
	<div class="field">
		<label>Avatar</label>
		<%= image_tag(current_user.avatar.url(:thumb)) %>
		<%= f.file_field :avatar %>
	</div>

	<div class="two fields">
		<% # First name field %>
		<div class="field">
			<label>First Name</label>
			<%= f.text_field :first_name, autofocus: true, placeholder: "John" %>
		</div>

		<% # Lat name field %>
		<div class="field">
			<label>Last Name</label>
			<%= f.text_field :last_name, placeholder: "Smith" %>
		</div>
	</div>

	<% # Username field %>
	<div class="field">
		<label>Username</label>
		<%= f.text_field :username, placeholder: "johnsmith646" %>
	</div>

	<% # Email field %>
	<div class="required field">
		<label>Email</label>
		<%= f.email_field :email, placeholder: "email@address.com" %>
	</div>

	<% # Devise checker %>
	<% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
		<div>Currently waiting confirmation for: <%= resource.unconfirmed_email %></div>
	<% end %>

	<% # New Password Field %>
	<div class="field">
		<label>New Password <i>(leave blank if you don't want to change it)</i></label>
		<%= f.password_field :password, autocomplete: "off", placeholder: "Enter your new password", class: "password-popup" %>
	</div>

	<% # Confirm new password field %>
	<div class="field">
		<label>Confirm New Password</label>
		<%= f.password_field :password_confirmation, autocomplete: "off", placeholder: "Confirm your new password" %>
	</div>

	<% # Old Password field %>
	<div class="required field">
		<label>Current Password <i>(we need your current password to confirm your changes)</i></label>
		<%= f.password_field :current_password, autocomplete: "off", placeholder: "Enter your current password" %>
	</div>

	<% # Update/Submit action %>
	<div class="actions">
		<%= f.submit "Update", class: "ui button" %>
	</div>

<% end %>

<% # Delete account option %>
<div class="ui row margin-top">
	<div class="ui divider margin-top"></div>
	<%= button_to "Delete my account", registration_path(resource_name), data: { confirm: "Are you sure, this cannot be undone?" }, method: :delete, class: "ui sell-red-button button" %>
</div>
